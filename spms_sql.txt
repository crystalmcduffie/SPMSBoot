CREATE TRIGGER before_insert_genre_committee
BEFORE INSERT ON genre_committee
FOR EACH STATEMENT
BEGIN
   IF 
	(SELECT name from person join role on person.role_id = role.id where person.id = NEW.editor_id)
	= 'editor'
THEN
	INSERT INTO genre_committee(genre_id,editor_id,editor_status_id)
        VALUES(NEW.genre_id,NEW.editor_id,NEW.editor_status_id);
    END IF;
END;

create or replace procedure before_insert_genre_committee(genre_id int, editor_id int, editor_status_id int) as $$ 
declare
	role_name varchar;
begin
	select name into role_name from person join role on person.role_id = role.id where person.id = editor_id;
	
	if role_name = 'editor' then 
		insert into genre_committee(genre_id,editor_id,editor_status_id) values(genre_id,editor_id,editor_status_id);
    else
    	raise exception 'Person % must be an editor', editor_id;
    end if;
	end;
$$ language plpgsql;

create or replace function before_insert_genre_committee()
returns trigger
language plpgsql
as 
$$
declare
	role_name varchar;
	editor_id int;
begin
	select new.editor_id into editor_id;
	select name into role_name from person join role on person.role_id = role.id where person.id = editor_id;
	
	if role_name = 'editor' then 
		insert into genre_committee(genre_id,editor_id,editor_status_id) values(new.genre_id,new.editor_id,new.editor_status_id);
    else
    	raise exception 'Person % must be an editor', editor_id;
    end if;
   return new;
	end;
$$